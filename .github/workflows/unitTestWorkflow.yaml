name: Unit Test
on:
    push:
        branches:
            - main

jobs:
    job1:
        name: Tests
        runs-on: ubuntu-latest
        outputs:
            failed: ${{ steps.validate-tests-with-errors.outputs.failed }}
            success: ${{ steps.validate-tests-without-errors.outputs.success }}
        steps:
        - name: Checkout repository
          uses: actions/checkout@v3
        - name: Python environment configuration
          uses: actions/setup-python@v3
          with:
            python-version: 3.13
        - name: Install dependencies
          run: |
            python -m pip install --upgrade pip
            pip install -r requirements.txt
        - name: Run tests
          id: run-tests
          run: python -m unittest -v tests/test_persona.py
        - name: Validate tests with errors
          id: validate-tests-with-errors
          if: ${{ failure() }}
          env:
            ERROR_MESSAGE: "One or more tests failed"
          run: |
            echo "failed=${ERROR_MESSAGE}" >> $GITHUB_OUTPUT
        - name: Validate tests without errors
          id: validate-tests-without-errors
          if: ${{ success() }}
          env:
            SUCCESS_MESSAGE: "All tests passed"
          run: |
            echo "success=${SUCCESS_MESSAGE}" >> $GITHUB_OUTPUT
        - name: Coverage report
          id: coverage
          run: |
            coverage run -m unittest tests/test_persona.py
            coverage report -m